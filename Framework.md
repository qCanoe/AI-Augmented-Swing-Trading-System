**AI-Augmented Swing Trading System for BTC/ETH (3–7D, Low-Leverage, CEX)**

一个结合**传统技术指标**与**通用大模型（LLM）现场分析**的中短周期（3–7 天）自动交易系统，面向 BTC / ETH 的低倍合约交易，核心目标是 **降低回撤、过滤低质量交易、提升风险调整后收益** 。

---

## 一、项目目标与设计原则

### 1.1 项目目标

本项目的目标不是“预测价格”，而是构建一个**可长期运行、可解释、可控风险**的自动交易框架，具体包括：

* 在 3–7 天持仓周期内，捕捉 BTC / ETH 的趋势性波段
* 通过通用 AI 模型参与“交易质量评估”和“风险过滤”
* 显式降低极端行情、事件窗口、拥挤交易导致的回撤
* 支持从回测 → 模拟 → 实盘的渐进式部署

---

### 1.2 核心设计原则

* **指标负责“发现机会”，AI 负责“否决与调节”**
* **AI 不直接下单，只输出结构化建议**
* **任何交易都必须通过硬风控规则**
* **宁可少交易，也不在错误状态下频繁交易**
* **系统必须支持 AI 不可用时的安全降级**

---

## 二、系统总体架构

系统采用“多层解耦 + AI 门控”的架构设计：

```
数据采集层
   ↓
指标与结构分析层（Candidate Generator）
   ↓
AI 决策门控层（LLM via OpenRouter）
   ↓
风险与仓位控制层（Rule-based）
   ↓
执行层（CEX 合约）
   ↓
监控与日志 / 回测评估
```

AI 被明确放置在 **策略与执行之间** ，作为一个 **受限的决策组件（Gatekeeper）** 。

---

## 三、交易设定与约束条件

* 交易标的：BTC / ETH（高度相关，统一风险预算）
* 市场环境：中心化交易所（CEX）
* 产品类型：USDT 本位永续合约
* 杠杆范围：1–3x（低倍）
* 持仓周期：3–7 天
* 信号频率：每周约 1–4 次
* 单笔最大风险：账户净值的 0.5%–1%

---

## 四、数据层设计

### 4.1 使用数据类型

**价格与波动数据**

* 4H / 1D OHLCV
* ATR(14)（4H）
* EMA20 / EMA50（4H & 1D）

**衍生品与情绪数据**

* Funding Rate（8h）
* Open Interest 及其变化率
* 多空比 / 拥挤度指标（如可获取）

**事件与时间特征**

* CPI / FOMC 等宏观事件日历
* 周内时间效应（Weekday）

---

### 4.2 数据预处理原则

* 不向 AI 提供原始 tick 或完整 K 线序列
* 所有输入数据必须被压缩为**结构化摘要**
* 关键连续变量转为分位数 / 极端标签（如 LOW / NORMAL / HIGH）

---

## 五、指标与候选交易生成层（非 AI）

该层完全基于 **确定性规则** ，用于生成少量“候选交易”。

### 5.1 市场状态判定（简化三态）

* **Trend** ：1D EMA20 / EMA50 同向，斜率明确
* **Range** ：EMA 缠绕、ATR 收缩
* **No-Trade** ：高波动 / 事件 / 结构破坏

---

### 5.2 核心策略：趋势回踩入场

典型触发条件示例：

* 1D 趋势方向明确
* 4H 回踩 EMA20 或 EMA50
* 回踩期间 ATR 未显著放大
* OI 未出现明显去杠杆

满足条件后生成一个  **Trade Candidate** ，但 **不直接下单** 。

---

## 六、AI 决策门控层（核心创新点）

### 6.1 AI 的角色定位

通用 AI（通过 OpenRouter 接入）仅负责：

1. 判断该候选交易在 **3–7 天周期内的成功概率**
2. 标记潜在风险状态（事件 / 拥挤 / 高波动等）
3. 给出仓位建议或“禁止交易”意见

AI  **没有任何直接执行权限** 。

---

### 6.2 AI 输入（标准化快照）

每次调用 AI 时，系统生成一个固定结构的“市场快照”，例如：

* 趋势方向（UP / DOWN / NEUTRAL）
* ATR 分位（LOW / NORMAL / HIGH）
* Funding 状态（EXTREME+ / NORMAL / EXTREME-）
* OI 变化（UP / FLAT / DOWN）
* 是否存在宏观事件（YES / NO）
* 候选交易类型（Trend Pullback）

---

### 6.3 AI 输出（强制结构化）

AI 只允许输出固定 JSON：

```json
{
  "decision": "ALLOW | DENY | REDUCE",
  "confidence": 0.0,
  "risk_flags": ["EVENT", "OVERLEVERAGED", "VOLATILE"],
  "key_reasons": ["..."],
  "invalid_if_missing": []
}
```

任何格式错误、越权推断、缺失字段 →  **视为 DENY** 。

---

### 6.4 推荐模型策略（OpenRouter）

* 主模型：高推理能力模型（如 Claude / DeepSeek Reasoner）
* 低温度（接近 0），确保一致性
* 可选双调用一致性校验（不一致则保守处理）

---

## 七、风险与仓位控制层（非 AI）

这是系统中 **最高优先级模块** 。

### 7.1 硬性风控规则

* 单笔最大风险 ≤ 1%
* BTC + ETH 合并风险敞口限制
* 连续亏损 / 周最大亏损触发停机
* 时间止损（超过 5–7 天强制退出）

---

### 7.2 AI 输出的使用方式

* `decision = DENY` → 禁止开仓
* `confidence` → 仓位系数（如 0.6 → 使用 60% 风险预算）
* `risk_flags` → 动态止损收紧 / 禁交易窗口

---

## 八、执行层设计

* 限价单 + 容忍滑点
* 服务器端止损（不可撤销）
* 执行失败重试与状态回滚
* AI 模块不可用时自动降级为“纯指标 + 更严格风控”

---

## 九、回测与评估框架

### 9.1 回测方法

* Walk-forward（按时间滚动）
* 牛 / 熊 / 震荡阶段分段评估
* 对比三组结果：
  * 无 AI
  * AI 过滤
  * AI + 动态仓位

---

### 9.2 关键评估指标

* 最大回撤（优先级高于收益）
* 回撤恢复时间
* 单笔期望值
* 交易频率变化
* 极端行情下的表现

---

## 十、项目阶段规划（建议）

**阶段 1（MVP）**

* BTC only
* 只做多
* AI 仅做交易过滤

**阶段 2**

* 加入 ETH
* AI 输出参与仓位调节

**阶段 3**

* 多模型对比 / 冗余
* 长期稳定性评估
